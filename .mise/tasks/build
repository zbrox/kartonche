#!/usr/bin/env bash
#MISE description="Build the app (Debug configuration)"

set -euo pipefail

# Use IOS_DEVICE if set, otherwise default to iPhone 17 Pro
DEVICE="${IOS_DEVICE:-iPhone 17 Pro}"

echo "Building kartonche for $DEVICE..."
echo ""

# Capture build output and format with xcbeautify
# Use -quiet to reduce noise, xcbeautify will show warnings/errors prettily
set +e  # Don't exit on build failure, we want to see formatted errors
xcodebuild \
  -project "$PROJECT" \
  -scheme "$SCHEME" \
  -configuration "$CONFIGURATION" \
  -destination "platform=iOS Simulator,name=$DEVICE" \
  -quiet \
  build | xcbeautify

BUILD_EXIT_CODE=${PIPESTATUS[0]}
set -e

if [ $BUILD_EXIT_CODE -eq 0 ]; then
  echo ""
  echo "✅ Build succeeded"
else
  echo ""
  echo "❌ Build failed with exit code $BUILD_EXIT_CODE"
  exit $BUILD_EXIT_CODE
fi
