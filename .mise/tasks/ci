#!/usr/bin/env bash
#MISE description="Full CI check (generate merchants + build + test)"

set -euo pipefail

echo "ğŸ”„ Running CI workflow..."
echo ""

# Check if merchants.kdl exists, if so validate and generate
if [ -f "$MERCHANTS_FILE" ]; then
  echo "Step 1/3: Validating and generating merchants..."
  if [ -d "Scripts/generate-merchants" ]; then
    mise run validate-merchants
    mise run generate-merchants
  else
    echo "âš ï¸  Merchant generation not set up yet, skipping..."
  fi
else
  echo "âš ï¸  No merchants.kdl found, skipping merchant generation..."
fi

echo ""
echo "Step 2/3: Building..."
mise run build

echo ""
echo "Step 3/3: Running tests..."
mise run test-all

echo ""
echo "âœ… CI workflow complete"
